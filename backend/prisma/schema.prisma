// FleetFlow - Fleet & Logistics Management System
// PostgreSQL + Prisma ORM

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  FLEET_MANAGER
  DISPATCHER
  SAFETY_OFFICER
  FINANCIAL_ANALYST
}

enum VehicleStatus {
  available
  on_trip
  in_shop
  retired
}

enum DriverStatus {
  available
  on_trip
  off_duty
  suspended
}

enum TripStatus {
  draft
  dispatched
  completed
  cancelled
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      Role
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Vehicle {
  id           String        @id @default(cuid())
  model        String
  licensePlate String        @unique
  capacity     Float         // in kg or units
  odometer     Float         @default(0)
  status       VehicleStatus @default(available)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  trips          Trip[]
  maintenanceLogs MaintenanceLog[]
  fuelLogs       FuelLog[]

  @@map("vehicles")
}

model Driver {
  id          String       @id @default(cuid())
  name        String
  licenseNo   String       @unique
  licenseExpiry DateTime
  safetyScore Float        @default(100) // 0-100
  status      DriverStatus @default(available)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  trips Trip[]

  @@map("drivers")
}

model Trip {
  id          String     @id @default(cuid())
  reference   String     @unique
  cargoWeight Float
  origin      String
  destination String
  status      TripStatus @default(draft)
  dispatchedAt DateTime?
  completedAt  DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  vehicleId String
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Restrict)
  driverId  String
  driver    Driver  @relation(fields: [driverId], references: [id], onDelete: Restrict)

  @@map("trips")
}

model MaintenanceLog {
  id        String   @id @default(cuid())
  type      String   // oil_change, tire_replacement, brake_repair, etc.
  cost      Float
  date      DateTime
  notes     String?
  createdAt DateTime @default(now())

  vehicleId String
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@map("maintenance_logs")
}

model FuelLog {
  id        String   @id @default(cuid())
  liters    Float
  cost      Float
  date      DateTime
  odometerAtFill Float?
  createdAt DateTime @default(now())

  vehicleId String
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@map("fuel_logs")
}
